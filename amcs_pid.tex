\documentclass{amcs}
\usepackage{verbatim}

\title[Implemention and evaluation...]{Implementation and evaluation of fine-tuning methods of PI controller with PLC-PID Tuner}

\author[ad1][ad2]{Jakub MOŻARYN}
\author[ad1][]{Damian SUSKI}
\author[ad1][ad2]{Arkadiusz WINNICKI}


\correspondingauthor{Second AUTHOR}

\address[ad1]{Institute of Automatic Control and Robotics\\ Warsaw University of Technology, Address ul. Sw. A. Boboli 8, 02-525, Warsaw, Poland\\ e-mail: \url{j.mozaryn@mchtr.pw.edu.pl}}


\Runauthors{F. Author \it{et al.}}
%\Runauthors{J. Doe}
%\Runauthors{J. Doe and M. John}

%PLEASE DO NOT MODIFY OR REMOVE THESE!
%\Year{}
%\Vol{}
%\No{}
%\Startpage{}
%\Endpage{}
%\DOI{}
%\Received{}
%\Revised{}
%\Rerevised{}
%\Accepted{}

\bibliographystyle{dcu}

\begin{document}
\begin{abstract}
In the paper, the method of an iterative modification of tuning parameters of a PI controller is presented. Proposed algorithms base on the off-line evaluation of quality indices. They were tested using PLC-PID Tuner - the application developed for tuning PID controller in S7 Simatic PLCs. It was shown that for some cases  proposed iterative method of modifying tuning parameters might increase the control quality. Furthermore, the gain margin and phase margin achieved  through this method are close to values recommended for  practical applications.
\end{abstract}

\begin{keywords}
keyword 1, keyword 2, \dots, keyword 5. Please provide a few keywords (3--5) and keep them specific.
\end{keywords}
\maketitle

\section{Introduction}
Despite all the progress in advanced control, the PID (proportional-integral-derivative) algorithm remains the most popular. Its gains are often chosen independently by an engineer, based on his experience or through some simple selection methods such as \textit{Ziegler-Nichols} \cite{Ziegler:1942} or \textit{Cohen-Coon} \cite{Cohen:1953}. However, regardless of the type of controlled process, there is usually requirement of exact response of the system. Without proper methodology of controller parameters tunig the quality of the control system may be unsatisfactory. Therefore many scientists and engineers develop tuning rules for different processes, where they consider different objectives. The survey presented in \cite{Odwyer:2006} gives the total of 1134 separate rules for PI and PID controllers. Such statistics were done in 2006, and one can expect that until now this number has increased significantly.

Nowadays, most of small and medium size production lines are controlled by Programmable Logic Controllers (PLC) which allow user to create the simple single loop control system as well as more complex structures. The main issue that ensures the correct functionality of the automation system is a proper adjustment of controller parameters. It should allow to minimize the deviation of the process variables from the desired output response, and therefore reduce the cost of the process due to the energy and material losses. 

In many practical situations, it is impossible to develop one's own tuning rules. Popularity of PLC controllers result in the need to implement appropriate tools that support user during controller tuning. Unlike automation systems based on dedicated controllers such as Distributed Control System (DCS), solutions based on PLC don't have such wide support in terms of integration and operation of control algorithms. 

Recently, manufacturers of automation systems develop advanced software tools that allow autotuning of PID controllers implemented in PLC's, using  proprietary algorithms based on relay or area auto-tuning methods \cite{Astrom:1995}, \cite{Yu:2006}, \cite{Trybus:2011}. Such modules which facilitate PID tuning are integrated within e.g. TIA Portal (Siemens), Automation Studio (B\&R) or TwinCAT (Beckhoff) software. However, implemented  methods don't allow designing control system in terms of specific performance indexes \cite{Bishop:2010}, \cite{Mozaryn:2013} e.g. gain and phase margin, integral of the squared error (ISE) or the integral of the absolute value of error (IAE). Therefore, it has limited use in processes which apart from minimizing standard indices, must meet additional criteria like sensitivity or robustness. 

Most applications that allow identification (e.g. IDCAD \cite{Janiszowski:2002}, MATLAB/Simulink, LabVIEW) don't have automatic procedures for tuning the specific controller, especially in industrial environment where the additional software is required to communicate with PLC to collect and archive values of the process variables. After process identification, controller parameters can be calculated   \cite{Odwyer:2009} and then implemented in PLC. Based on these premises the choice of proper method in industrial environment can be very complicated and time consuming. Therefore, the possibility to test, compare and use of wide variety of methods is very reduced. 

These facts were the inspiration to create PLC-PIDTuner application which combines above mentioned functionalities: real process data collection using Simatic S7 1200/1500 controllers, SISO system identification, tuning of PID controller parameters with different methods, verification of the control system in time and frequency domains using various performance indices. PLC-PIDTuner simplifies the tuning rule selection process and can be used by the field engineers with basic knowledge of control engineering.

The article is organized as follows. In section II, the implementation details of PLC-PIDTuner are described. Then, in section III, the PLC controller tuning methodology is presented. Section IV describes results obtained during exemplary verification of developed application, based on a model of the 3rd order lag system with delay. Finally, in section V further development ideas are presented and in section VI concluding remarks are given..

\section{Implementation details}
%
PLC-PIDTuner is based on the open and free standards. Application allows tuning of \texttt{PID\_Compact} function block implemented in SIMATIC S7-1200 and S7-1500 controllers which are relatively new products in Siemens SIMATIC S7 products line \cite{Mozaryn:2016}. 

In PLC-PIDTuner there are implemented numerous methods, supporting different stages of the control system design: 
%

\subsection{Procedure of the controller parameters tuning with PLC-PIDTuner}
Presented application  divides controller tuning process into three main steps:

\begin{enumerate}
	\item STEP 1: Process identification.
	\item STEP 2: Calculation of the controller parameters.
	\item STEP 3: Verification of the control system performance in time and frequency domains.
\end{enumerate}

Thorough procedure divided into different sub-stages is presented in Fig. \ref{fig1}. Application contains simulation tools to verify the performance of the system in each sub-stage. Consequently, problems with the tuning process or decrease of an accuracy can be detected early and corrected. 

There is possibility to extend PLC-PIDTuner functionality by implementing identification methods, tuning methods and performance indices in standardized, separate DLL libraries. Such approach allows adapting the application to user needs based on expert knowledge of controlled industrial process. 

\subsection{Process identification}
%
The identification procedure provides mathematical model of process calculated on the basis of collected data of the control and process variables. It usually requires generation of proper excitation signal which affects industrial process and results in financial losses. Therefore, signal shape and parameters are often limited. PLC-PIDTuner allows coosing the suitable, least invasive excitation signal and set it's shape and parameters e.g. range of values or start/stop times of the step function.

In PLC-PIDTuner there are implemented following identification methods:
\begin{enumerate}
	\item secant method \cite{Haber:1999},
	\item tangent method \cite{Haber:1999},
	\item \textit{Strejc} method \cite{Strejc:1959},
	\item extended least squares (ELS) method  \cite{Janiszowski:2002}.
\end{enumerate}

Each method can be invoked in the application, and identified model parameters are saved for further controller tuning and process simulation. Moreover, user is able to select and compare several models identified by means of different methods. 

Secant, tangent and \textit{Strejc} methods are based on step response and specified mathematical model of the plant. Therefore they are mainly used for rough approximation of plant dynamics, which is often insufficient for the purpose of computer simulation or controller tuning. Therefore, ELS method is implemented, which is more accurate and easy in numerical implementation. 

PLC-PIDTuner allows user to compare determined model with the real plant by automatically calculating the response of the model. It allows verifying the quality of identified model using several indexes e.g. Integral Squared Error (ISE),  Integral Absolute Error (IAE), Integral Time-weighted Absolute Error (ITAE) and select the best of several models.

\subsection{Tuning of the controller parameters}
%
Tuning of the controller parameters is performed on the basis of the process model identified in previous stage. There are impemented over 500 tuning methids, classified into groups based on the model type \cite{Odwyer:2009}. Furthermore, user has the possibility to select proper tuning method in terms of:
%
\begin{itemize}
	\item control algorithm (P, PI, PD, PID),
	\item type of tuning method \cite{Odwyer:2009},
	\item minimization of specified quality index,
	\item additional options e.g. required overshoot.
\end{itemize}

The set of the methods and calculated parameters, can be further examined using  built-in time and frequency domains analysis modules. It should be emphasized, that all simulations are carried out with real PLC controller that communicates with PLC-PIDTuner.

Such functionality enables to choose the set of controller parameters more precisely. By modifying controller parameters and subsequently verifying control system response, user can adjust its properties to meet the control objectives. Furthermore, build-in simulation helps to verify designed control system without the need of costly experiments performed with the real process.
%
\subsection{Analysis of the control system performance}
%
After adjusting and downloading controller parameters, PLC-PIDTuner application allows user to verify operation of real control system. It is possible to plot and archive process variable values, change controller mode (Auto/Manual) or change set point value. Therefore, different quality indices in time domain can be calculated for the designed system. There were implemented 7 basic quality indices in time and frequency domain, described in detail in \cite{Kolaj:2015}.

Build-in PLC-PIDTuner module for analysis in frequency domain  allows operator to automatically draw \textit{Bode} and \textit{Nyquist} plots using simulation of the identified model. PLC-PIDTuner determines stability margins of the designed control system by calculating phase ($\Delta \phi$) and gain ($\Delta L$) margins \cite{Bishop:2010} \cite{Holejko:2010}. These values characterize the robustness of the control system to changes of the process parameters caused e.g. by aging of the actuators. 

On the basis of collected data PLC-PIDTuner automatically calculates values of selected quality indexes. It allows user to rate real control systems operation in terms of certain properties. If real control system does not meet the requirements, the steps of controller parameters  calculation or process mathematical model identification should be repeated.

\subsubsection{Time domain analisys}
%
The quality of the control system was analyzed in the time domain using following indexes: 
\begin{itemize}
	\item Maximum error 
	\begin{equation}
	e_{\text{sp}\max}=\max_{k}[e_{\text{sp}}(k)]
	\end{equation}\label{eq22}
	\item Overshoot 
	\begin{equation}
	\gamma=\left|\dfrac{e_2}{e_1}\right|100\%
	\end{equation}\label{eq24}
	where $e_1$ and $e_2$ are the first 2 consecutive biggest errors with opposite signs, assuming as the zero level (baseline) the steady state value of the output signal $y(t)$ after transient response.
	\item Transient response time $T_{R}$ - it is the time between the moment of change of the set point $y_{\text{sp}}(k)$ , or introduction of disturbances $d(k)$ and the moment when  error (\ref{eq22}) reaches a fixed value inside a boundary $|0.05 e_{\text{sp}\max}(k)|$. 
	\item Integral Squared Error 
	\begin{equation}
	\text{ISE}_{\text{sp}}=\sum_{k}[e_{\text{sp}}(k)]^{2} 
	\end{equation}\label{eq25}
	\item Integral of Absolute Value of Error 
	\begin{equation}
	\text{IAE}_{\text{sp}}=\sum_{k}|e_{\text{sp}}(k)| 
	\end{equation}\label{eq26}
\end{itemize}

\subsubsection{Frequency domain analysis}
%
In the next step, based on the simulation with model characterized by lowest ISE (ELS, rank 3), stability margins of the designed control systems were calculated (see Tab. \ref{tab3}). Gain margin determines how much the magnitude of the control system should increase, to make it unstable. Control systems with sufficiently large gain margin and phase margin are robust to changes in the parameters of the object and external distortions. Knowledge of the stability margins values allow also to adjust controller parameters in order to improve quality in the time domain \cite{Mozaryn:2013}.   

\subsection{Fine-tuning of PID controller}

Desired control system, was characterized by following properties:

\begin{itemize}
\item Property 1: Short   of the step response.
\item Property 2: Short   after abrupt occurrence of disturbances.
\item Property 3: Output signal should have no visible high-frequency oscillations.
\end{itemize}

The overall performance of the examined control system with controller pa-rameters set according to A-R rules is good (Table 1). However, because of the long transient response to disturbances, there was proposed method of parameters modification (fine-tuning) to reduce it.

To specify the robustness of the system there was performed analysis in the frequency domain. There were calculated gain margin   and phase margin  of the control system [10]. Gain margin determines how much the magnitude of the control system should increase, to make it unstable. Control systems with sufficiently large gain margin and phase margin are robust to changes in the pa-rameters of the object and external distortions. If   and   decrease, the control system has transient oscillatory character and the overshoot, but also has short transient response time. For further modifications there was chosen only the integration time  . In case of the FOLPD plant model (1) index   decrease with reduction of parameter [11]. 

In the proposed heuristic iterative modification procedure parameter   was reduced in order to comply with the following assumptions:

Assumption 1: Step response overshoot should be less than 5 \%.

Assumption 2: The change of   should be less than 25\% of the original value and   should be less than 25\% of the original value. 

Proposed PID fine-tuning iterative procedure can be presented in the form of algorithm as follows:

\begin{algorithm}[!h]
	\caption{Fine-tuning algorithm.}
	\label{a:alg1}
	\textbf{Step 1.} Set  . Enter the pre-tuned set of PID settings, perform the step re-sponse experiment. Calculate and save values:  ,  ,  , and  .
	
	\smallskip
	\textbf{Step 2.} Set   ,  and   .
	
	\smallskip
	\textbf{Step 3.} Perform step response experiment, calculate values   ,  ,  .
	
	\smallskip
	\textbf{Step 4.} If  , go to step 5, else go to step 6.
	
	\smallskip
	\textbf{Step 5.} If   and   go to step 2, else go to step 6.
	
	\smallskip
	\textbf{Step 6.} Set  .
	
	\smallskip
	\textbf{Step 7.} Stop the algorithm.
	
\end{algorithm}

\begin{comment}
Nastawy regulatora PID wyznaczone różnymi metodami opisanymi w literaturze często nie zawsze zapewniają wynikiów regulacji satysfakcjonujących satysfakcjonujące projek-tanta. Sposobem na poprawę jakości regulacji może być opisana w [11] iteracyjna metoda modyfikacji nastaw regulatora, która umożliwia polepszenie otrzymanych wskaźników regulacji, a w szczególności:
1.	skrócenie czasu regulacji na wymuszenie skokowe,
2.	skrócenie czasu regulacji przy wystąpieniu zakłócenia,
3.	brak wysokich częstotliwości w sygnale wyjściowym.
Iteracyjna metoda dostrajania regulatora (ang. fine–tuning -  FT) zaimplementowana w aplikacji PLC-PID Tuner wymaga, aby regulator był już zainstalowany w układzie oraz po-siadał wstępnie dobrane nastawy. Następnie wybierana jest nastawa do modyfikacji i rejestrowana jest odpowiedź układu na wymuszenie skokowe. Kolejnym krokiem jest obliczenie przeregulowania, zapasu modułu  i fazy. Założenia opisywanej metody są następujące [5]:
1.	przeregulowanie nie może przekroczyć 5\%,
2.	zapas modułu powinien być większy od 75\% wartości początkowej,
3.	zapas fazy powinien być większy od 75\% wartości początkowej.

Dokładny schemat postępowania przedstawiony jest w postaci algorytmów A1 i A2.
Algorytm FT - A1 (iteracyjna modyfikacja wzmocnienia regulatora):
1.	Ustawić krok iteracji k = 0. Ustawić w regulatorze początkowo dobrane wartości na-staw: kp0, Ti0 i Td0. Zbadać zachowanie układu na wymuszenie skokowe. Obliczyć i zapisać w pamięci wartości parametrówwskaźników: przeregulowanie (κ), zapas modułu (M0) oraz zapas fazy (φ0). Przyjąć kp,0 = kp0.
2.	Ustawić k = k + 1, a następnie kp,k = 1,05 • kp,k-1.
3.	Zbadać zachowanie układu na wymuszenie skokowe. Obliczyć i zapisać w pamięci wartości parametrów: κ, Mk oraz φk.
4.	Jeżeli κ<5\% przejść do kroku 5 – ego. W innym przypadku przejść do kroku 6
5.	Jeżeli Mk < (1 ± 0,3) M0 i φk < (1 ± 0,3)φ0, przejść do kroku 2. W innym przypadku kontynuować do kroku 6.
6.	Ustawić lub kp = kp,k-1.
7.	Koniec algorytmu.
Algorytm FT - A2 (iteracyjna modyfikacja czasu całkowania regulatora)::
1.	Ustawić k = 0. Ustawić w regulatorze początkowo dobrane wartości nastaw: kp0, Ti0 i Td0. Zbadać zachowanie układu na wymuszenie skokowe. Obliczyć i zapisać w pa-mięci wartości parametrówwskaźnikow: przeregulowanie (κ), zapas modułu (M0) oraz zapas fazy (φ0). Przyjąć Ti,0 = Ti0.
2.	Ustawić k = k + 1, a następnie Ti,k = 0,95 • Ti,k-1.
3.	Zbadać zachowanie układu na wymuszenie skokowe. Obliczyć i zapisać w pamięci wartości parametrówwskaźników: κ, Mk oraz φk.
4.	Jeżeli κ<5\% przejść do kroku 5 – ego. W innym przypadku przejść do kroku 6.
5.	Jeżeli Mk < (1 ± 0,3) M0 i φk < (1 ± 0,3)φ0, przejść do kroku 2. W innym przypadku kontynuować do kroku 6.
6.	Ustawić Ti = Ti,k-1.
7.	Koniec algorytmu.
5.4.1.	Iteracyjne dostrajanie w programie PLC-PID Tuner
Program PLC PID Tuner umożliwia przeprowadzenie procedury Fine – Tuningu  w trybie offline. Wykorzystany jest zaimplementowany w aplikacji symulator układu regulacji [9]. W programie zaimplementowano oba opisane algorytmy. Użytkownik za pomocą kontro-lek (Rysunek 5.11, Rysunek 5.12) wybiera rodzaj algorytmu. System sprawdza czy są speł-nione wymagania do przeprowadzenia procedury FT:
•	sprawdzane jest czy obiekt regulacji istnieje,
•	sprawdzane jest czy regulator istnieje,
•	sprawdzany jest tryb pracy regulatora – w algorytmie A1, tryb pracy regulatora może być dowolny, zaś przy algorytmie A2 dopuszczalny tryb pracy to PI lub PID,
Jeśli wymagania są spełnione to zapisywane są parametry istniejącego układu regulacji: kp0, Ti0, Td0, κ, M0 i φ0. Następnie za pomocą zaimplementowanego w programie symulatora układu regulacji (rozdział 3) rejestrowana jest odpowiedź układu regulacji na wymuszenie skokowe. Kolejną czynnością jest obliczenie nowych wartości κ, Mk oraz φk. Jeśli wymagania opisane w A1 lub A2 są spełnione algorytm jest kontynuowany. Po zakończeniu FT użytkownik jest informowany o wyniku, a nowe nastawy są wpisywane do regulatora w pro-jekcie. Naciśnięcie przycisku Fine Tuning na Rysunek 5.12 Okno Fine Tuningu wywołuje metodę FineTuning, która sprawdza czy spełnione są wymagania do przeprowadzenia FT i wyświetla nowe okno do wyboru nastawy, która ma być poddana modyfikacji.
\end{comment}

\section{Expemental verification}

\subsection{Control system structure}
%
The process was controlled in closed-loop control system, presented in Fig. 2.

In the control system (Fig. 2), an output of the process   is the liquid level in the tank Z1 (H1). It is compared with the desired output response (setpoint)   and an output error is given as:
\begin{equation}
e(t)=y(t)-w(t)
\end{equation}
The error (1) is used by the controller to adjust the control signal   which, through an actuator (pump) affects the regulated process. In the system there are disturbances   (leakage) which can be introduced, as it is described in chapter 2.

The control algorithm was implemented on a Siemens S7-1200 PLC controller. 

\subsection{Identification of the control plant}

\subsection{Selection of PID controller parameters}

For the control of the process there was used the PID controller in the parallel form with filtered derivative part, described by the following equation [9]:
(3)
where    is proportional gain,   is integral time constant,   is derivative time constant and   is time constant of filter (  is chosen usually as 8÷10 [4]).
The quality of the control system was analyzed in the time domain using fol-lowing indexes:
Maximum error
(4)
Overshoot
(5)
where   and   are the first 2 consecutive biggest errors with opposite signs, as-suming steady state value of output   after transient response as the zero level (baseline).
Transient response time  - it is the time between the moment of change of the set point  , or introduction of disturbances   , and the moment when the error   reaches a fixed value inside a boundary  .
Integral Squared Error
(6)
%
\subsection{Pre-tuning of PID controller}
In [9] there are described 1731 different types of PID tuning rules, so the proper criteria should be used to choose the most suitable settings. Tuning rules selection (pre-tuning) criteria were as follows:

a) Type of a process (stationary or nonstationary): the examined process is stationary process.
b) Model of the process: the equation (2) describes FOLPD model.
c) PID controller structure: the controller structure is described by (3).
d) The ratio of transport delay and the time constant of the process:
.	(7)
For the given model (2)  .

\subsection{Fine-tuning of PID controller}

Obtained quality indices after the iterative modifications (Algroithm A1), are gathered in Table 2.

\section{Conclusions}

\begin{acknowledgment}
Please acknowledge here all and any support, institutional or individual, which you have received for your work.
\end{acknowledgment}

\bibliography{amcs_pid}

\begin{biography}[photo]{Jakub Mo\.{z}aryn.}Place a brief biography here xxx xxx xxxxx xx xxx xxx xxx xx xxxx xx xxxxxxx xxx xxx xx xx xx xxxxx xx xxxx xxx xxx xxxxx xx xxx xxx xxx xx xxxx xx xxxxxxx xxx xxx xx xx xx xxxxx xx xxxx xxx xxx xxxxx xx xxx xxx xxx xx xxxx xx xxxxxxx xxx xxx xx xx xx xxxxx xx xxxx xxx xxx xxxxx xx xxx xxx xxx xx xxxx xx xxxxxxx xxx xxx xx xx xx xxxxx xx xxxx xxx xxx xxxxx xx xxx xxx xxx xx xxxx xx xxxxxxx xxx xxx xx xx xx xxxxx xx xxxx xxx xxx xxxxx xx xxx xxx xxx xx xxxx xx xxxxxxx xxx xxx xx xx xx xxxxx xx xxxx xxx xxx xxxxx xx xxx xxx xxx xx xxxx xx xxxxxxx xxx xxx xx xx xx xxxxx xx xxxx.
\end{biography}

\begin{biography}[]{Damian Suski.}Place a brief biography here xxx xxx xxxxx xx xxx xxx xxx xx xxxx xx xxxxxxx xxx xxx xx xx xx xxxxx xx xxxx xxx xxx xxxxx xx xxx xxx xxx xx xxxx xx xxxxxxx xxx xxx xx xx xx xxxxx xx xxxx xxx xxx xxxxx xx xxx xxx xxx xx xxxx xx xxxxxxx xxx xxx xx xx xx xxxxx xx xxxx xxx xxx xxxxx xx xxx xxx xxx xx xxxx xx xxxxxxx xxx xxx xx xx xx xxxxx xx xxxx xxx xxx xxxxx xx xxx xxx xxx xx xxxx xx xxxxxxx xxx xxx xx xx xx xxxxx xx xxxx xxx xxx xxxxx xx xxx xxx xxx xx xxxx xx xxxxxxx xxx xxx xx xx xx xxxxx xx xxxx xxx xxx xxxxx xx xxx xxx xxx xx xxxx xx xxxxxxx xxx xxx xx xx xx xxxxx xx xxxx.
\end{biography}

\begin{biography}[]{Arkadiusz Winnicki.}Place a brief biography here xxx xxx xxxxx xx xxx xxx xxx xx xxxx xx xxxxxxx xxx xxx xx xx xx xxxxx xx xxxx xxx xxx xxxxx xx xxx xxx xxx xx xxxx xx xxxxxxx xxx xxx xx xx xx xxxxx xx xxxx xxx xxx xxxxx xx xxx xxx xxx xx xxxx xx xxxxxxx xxx xxx xx xx xx xxxxx xx xxxx xxx xxx xxxxx xx xxx xxx xxx xx xxxx xx xxxxxxx xxx xxx xx xx xx xxxxx xx xxxx xxx xxx xxxxx xx xxx xxx xxx xx xxxx xx xxxxxxx xxx xxx xx xx xx xxxxx xx xxxx xxx xxx xxxxx xx xxx xxx xxx xx xxxx xx xxxxxxx xxx xxx xx xx xx xxxxx xx xxxx xxx xxx xxxxx xx xxx xxx xxx xx xxxx xx xxxxxxx xxx xxx xx xx xx xxxxx xx xxxx.
\end{biography}

\end{document}
